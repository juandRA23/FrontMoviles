<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FrontMoviles.DetalleServicioPage"
             Title="Detalle del Servicio"
             BackgroundColor="White"
             NavigationPage.HasNavigationBar="False">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" BackgroundColor="#4A7C59" Padding="20,50,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Botón regresar -->
            <Button Grid.Column="0" 
                    Text="←"
                    FontSize="24"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    WidthRequest="40"
                    HeightRequest="40"
                    Clicked="OnBackClicked" />

            <!-- Título -->
            <Label Grid.Column="1" 
                   Text="Detalle del Servicio"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center" />

            <!-- Botón compartir -->
            <Button Grid.Column="2" 
                    Text="📤"
                    FontSize="18"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    WidthRequest="40"
                    HeightRequest="40"
                    Clicked="OnCompartirClicked" />
        </Grid>

        <!-- Loading indicator -->
        <Grid Grid.Row="1" x:Name="LoadingGrid" IsVisible="False" BackgroundColor="White">
            <StackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="20">
                <ActivityIndicator IsRunning="True" Color="#4A7C59" />
                <Label Text="Cargando información..." 
                       FontSize="16"
                       TextColor="Gray"
                       HorizontalOptions="Center" />
            </StackLayout>
        </Grid>

        <!-- Contenido principal -->
        <ScrollView Grid.Row="1" x:Name="ContentScrollView" IsVisible="True">
            <StackLayout Spacing="0">

                <!-- Header del servicio -->
                <Grid x:Name="HeaderServicio" BackgroundColor="#F8F9FA" Padding="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Icono del servicio -->
                    <Frame Grid.Column="0"
                           x:Name="IconoFrame"
                           BackgroundColor="#A8D5BA"
                           CornerRadius="15"
                           WidthRequest="70"
                           HeightRequest="70"
                           HasShadow="False"
                           Padding="0">
                        <Label x:Name="IconoLabel"
                               Text="🔧"
                               FontSize="32"
                               TextColor="White"
                               HorizontalOptions="Center"
                               VerticalOptions="Center" />
                    </Frame>

                    <!-- Información básica -->
                    <StackLayout Grid.Column="1" Spacing="5" Margin="15,0,0,0" VerticalOptions="Center">
                        <Label x:Name="CategoriaLabel"
                               Text="CATEGORÍA"
                               FontSize="12"
                               TextColor="#4A90A4"
                               FontAttributes="Bold" />

                        <Label x:Name="TituloLabel"
                               Text="Título del Servicio"
                               FontSize="20"
                               TextColor="Black"
                               FontAttributes="Bold"
                               LineBreakMode="WordWrap" />

                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Label Text="⭐"
                                   FontSize="16"
                                   VerticalOptions="Center" />
                            <Label x:Name="CalificacionLabel"
                                   Text="4.8"
                                   FontSize="14"
                                   TextColor="Black"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center" />
                            <Label x:Name="ResenasLabel"
                                   Text="(23 reseñas)"
                                   FontSize="12"
                                   TextColor="Gray"
                                   VerticalOptions="Center" />
                        </StackLayout>
                    </StackLayout>

                    <!-- Precio -->
                    <StackLayout Grid.Column="2" HorizontalOptions="End" VerticalOptions="Center">
                        <Label x:Name="PrecioLabel"
                               Text="₡15,000"
                               FontSize="24"
                               TextColor="#4A7C59"
                               FontAttributes="Bold"
                               HorizontalOptions="End" />
                        <Label Text="por hora"
                               FontSize="12"
                               TextColor="Gray"
                               HorizontalOptions="End" />
                    </StackLayout>
                </Grid>

                <!-- Contenido detallado -->
                <StackLayout BackgroundColor="White" Spacing="25" Padding="20,25">

                    <!-- Descripción -->
                    <StackLayout Spacing="10">
                        <Label Text="Descripción" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <Frame BackgroundColor="#F8F9FA" CornerRadius="10" HasShadow="False" Padding="15">
                            <Label x:Name="DescripcionLabel"
                                   Text="Descripción completa del servicio..."
                                   FontSize="14"
                                   TextColor="Black"
                                   LineBreakMode="WordWrap" />
                        </Frame>
                    </StackLayout>

                    <!-- Disponibilidad -->
                    <StackLayout Spacing="10">
                        <Label Text="Disponibilidad" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <Frame BackgroundColor="#E8F5E8" CornerRadius="10" HasShadow="False" Padding="15">
                            <StackLayout Orientation="Horizontal" Spacing="10">
                                <Label Text="🕒"
                                       FontSize="20"
                                       VerticalOptions="Center" />
                                <Label x:Name="DisponibilidadLabel"
                                       Text="Lunes a viernes 2-6 PM"
                                       FontSize="14"
                                       TextColor="Black"
                                       VerticalOptions="Center"
                                       LineBreakMode="WordWrap" />
                            </StackLayout>
                        </Frame>
                    </StackLayout>

                    <!-- Especialidades/Subcategorías -->
                    <StackLayout x:Name="SubcategoriasContainer" Spacing="10">
                        <Label Text="Especialidades" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <FlexLayout x:Name="SubcategoriasFlexLayout"
                                    Direction="Row"
                                    Wrap="Wrap"
                                    JustifyContent="Start"
                                    AlignItems="Start">
                            <!-- Las subcategorías se cargarán dinámicamente -->
                        </FlexLayout>
                    </StackLayout>

                    <!-- Información del proveedor -->
                    <StackLayout Spacing="15">
                        <Label Text="Sobre el proveedor" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <Frame BackgroundColor="White" 
                               CornerRadius="10" 
                               HasShadow="True"
                               Padding="15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- Avatar del proveedor -->
                                <Frame Grid.Column="0"
                                       BackgroundColor="#E0E0E0"
                                       CornerRadius="30"
                                       WidthRequest="60"
                                       HeightRequest="60"
                                       HasShadow="False"
                                       Padding="0">
                                    <Label Text="👤"
                                           FontSize="28"
                                           TextColor="Gray"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center" />
                                </Frame>

                                <!-- Información del proveedor -->
                                <StackLayout Grid.Column="1" Spacing="5" Margin="15,0,0,0" VerticalOptions="Center">
                                    <Label x:Name="NombreProveedorLabel"
                                           Text="Nombre del Proveedor"
                                           FontSize="16"
                                           TextColor="Black"
                                           FontAttributes="Bold" />

                                    <Label x:Name="UbicacionProveedorLabel"
                                           Text="San José, Costa Rica"
                                           FontSize="14"
                                           TextColor="Gray" />

                                    <StackLayout Orientation="Horizontal" Spacing="10">
                                        <StackLayout Orientation="Horizontal" Spacing="3">
                                            <Label Text="✅"
                                                   FontSize="12"
                                                   VerticalOptions="Center" />
                                            <Label x:Name="ServiciosCompletadosLabel"
                                                   Text="15 servicios"
                                                   FontSize="12"
                                                   TextColor="Gray"
                                                   VerticalOptions="Center" />
                                        </StackLayout>

                                        <StackLayout Orientation="Horizontal" Spacing="3">
                                            <Label Text="📅"
                                                   FontSize="12"
                                                   VerticalOptions="Center" />
                                            <Label x:Name="MiembroDesdLabel"
                                                   Text="Desde 2023"
                                                   FontSize="12"
                                                   TextColor="Gray"
                                                   VerticalOptions="Center" />
                                        </StackLayout>
                                    </StackLayout>
                                </StackLayout>

                                <!-- Botón ver perfil -->
                                <Button Grid.Column="2"
                                        Text="Ver perfil"
                                        BackgroundColor="Transparent"
                                        TextColor="#4A7C59"
                                        BorderColor="#4A7C59"
                                        BorderWidth="1"
                                        FontSize="12"
                                        CornerRadius="15"
                                        Padding="15,8"
                                        VerticalOptions="Center"
                                        Clicked="OnVerPerfilClicked" />
                            </Grid>
                        </Frame>
                    </StackLayout>

                    <!-- Información de contacto mejorada -->
                    <StackLayout Spacing="15">
                        <Label Text="Información de contacto" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <!-- Email del proveedor -->
                        <Grid x:Name="EmailGrid" IsVisible="False">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label Grid.Column="0"
                                   Text="📧"
                                   FontSize="20"
                                   VerticalOptions="Center"
                                   Margin="0,0,15,0" />

                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="Correo electrónico"
                                       FontSize="12"
                                       TextColor="Gray" />
                                <Label x:Name="EmailProveedorLabel"
                                       Text="correo@ejemplo.com"
                                       FontSize="14"
                                       TextColor="Black"
                                       FontAttributes="Bold" />
                            </StackLayout>

                            <Button Grid.Column="2"
                                    Text="✉️"
                                    FontSize="16"
                                    BackgroundColor="Transparent"
                                    TextColor="#4A7C59"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    BorderColor="#4A7C59"
                                    BorderWidth="1"
                                    Clicked="OnEmailDirectoClicked" />
                        </Grid>

                        <!-- Teléfono del proveedor -->
                        <Grid x:Name="TelefonoGrid" IsVisible="False">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label Grid.Column="0"
                                   Text="📱"
                                   FontSize="20"
                                   VerticalOptions="Center"
                                   Margin="0,0,15,0" />

                            <StackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="Teléfono"
                                       FontSize="12"
                                       TextColor="Gray" />
                                <Label x:Name="TelefonoProveedorLabel"
                                       Text="+506 8888-8888"
                                       FontSize="14"
                                       TextColor="Black"
                                       FontAttributes="Bold" />
                            </StackLayout>

                            <!-- Botón WhatsApp -->
                            <Button Grid.Column="2"
                                    Text="💬"
                                    FontSize="16"
                                    BackgroundColor="Transparent"
                                    TextColor="#25D366"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    BorderColor="#25D366"
                                    BorderWidth="1"
                                    Margin="0,0,5,0"
                                    Clicked="OnWhatsAppDirectoClicked" />

                            <!-- Botón llamada -->
                            <Button Grid.Column="3"
                                    Text="📞"
                                    FontSize="16"
                                    BackgroundColor="Transparent"
                                    TextColor="#007AFF"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    BorderColor="#007AFF"
                                    BorderWidth="1"
                                    Clicked="OnLlamadaDirectaClicked" />
                        </Grid>

                        <!-- Separador -->
                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0" Margin="0,10" />

                        <!-- Información del servicio -->
                        <Label Text="Información del servicio" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="Black" />

                        <StackLayout Spacing="10">
                            <!-- Publicado -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0"
                                       Text="📅 Publicado:"
                                       FontSize="14"
                                       TextColor="Gray"
                                       VerticalOptions="Center" />

                                <Label Grid.Column="1"
                                       x:Name="FechaPublicacionLabel"
                                       Text="Hace 2 días"
                                       FontSize="14"
                                       TextColor="Black"
                                       FontAttributes="Bold"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>

                            <!-- Servicio ID -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0"
                                       Text="🆔 ID del servicio:"
                                       FontSize="14"
                                       TextColor="Gray"
                                       VerticalOptions="Center" />

                                <Label Grid.Column="1"
                                       x:Name="ServicioIdLabel"
                                       Text="#12345"
                                       FontSize="14"
                                       TextColor="Black"
                                       FontAttributes="Bold"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>

                            <!-- Categoría -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0"
                                       Text="🏷️ Categoría:"
                                       FontSize="14"
                                       TextColor="Gray"
                                       VerticalOptions="Center" />

                                <Label Grid.Column="1"
                                       x:Name="CategoriaInfoLabel"
                                       Text="Educación"
                                       FontSize="14"
                                       TextColor="Black"
                                       FontAttributes="Bold"
                                       HorizontalOptions="End"
                                       VerticalOptions="Center" />
                            </Grid>
                        </StackLayout>
                    </StackLayout>

                    <!-- Espacio adicional para el botón flotante -->
                    <BoxView HeightRequest="100" BackgroundColor="Transparent" />
                </StackLayout>
            </StackLayout>
        </ScrollView>

        <!-- Error view -->
        <Grid Grid.Row="1" x:Name="ErrorGrid" IsVisible="False" BackgroundColor="White">
            <StackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="20" Padding="40">
                <Label Text="😞"
                       FontSize="60"
                       HorizontalOptions="Center" />
                <Label x:Name="ErrorMessageLabel"
                       Text="No se pudo cargar la información del servicio"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="Gray"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center" />
                <Button Text="Reintentar"
                        BackgroundColor="#4A7C59"
                        TextColor="White"
                        CornerRadius="20"
                        Padding="30,10"
                        Clicked="OnReintentarClicked" />
            </StackLayout>
        </Grid>

        <!-- Botones de acción flotantes -->
        <Grid Grid.Row="2" BackgroundColor="White" Padding="20,15,20,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Botón contactar -->
            <Button Grid.Column="0"
                    Text="💬 Contactar"
                    BackgroundColor="Transparent"
                    TextColor="#4A7C59"
                    BorderColor="#4A7C59"
                    BorderWidth="2"
                    FontSize="16"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="25"
                    Clicked="OnContactarClicked" />

            <!-- Botón contratar -->
            <Button Grid.Column="2"
                    x:Name="ContratarButton"
                    Text="🤝 Contratar Servicio"
                    BackgroundColor="#4A7C59"
                    TextColor="White"
                    FontSize="16"
                    FontAttributes="Bold"
                    HeightRequest="50"
                    CornerRadius="25"
                    Clicked="OnContratarClicked" />
        </Grid>
    </Grid>
</ContentPage>